#!/usr/bin/env node
(function () {var b,c={};Object.defineProperty(c,"__esModule",{value:!0});var a=(f=void 0,t=c.linkedPackagesName=f,b=c.DEFAULT_RUNNER=t,c.WorkingFiles=b);c.Tasks=a;var f=".packages";c.linkedPackagesName=f;var ga,fa,t="firebase";c.DEFAULT_RUNNER=t,function(e){e.PACKAGE_JSON="package.json",e.PACKAGE_TEMP_JSON="package.temp.json"}(ga=b||(b={},c.WorkingFiles=b)),function(e){e.REVERT="--revert-changes",e.BUILD="--buildCommand",e.LEAVE_CHANGES="--leave-changes"}(fa=a||(a={},c.Tasks=a));var k={};Object.defineProperty(k,"__esModule",{value:!0});var r=(m=void 0,k.includes=m);k.nextOrDefault=r;var m=e=>process.argv.toString().includes(e);k.includes=m,r=(e,r=!0,$=e=>e)=>{if(process.argv.toString().includes(a[e])){const t=process.argv[process.argv.indexOf(e)+1];return t?t.includes("--")?r:$(t):r}return r},k.nextOrDefault=r;var w={};Object.defineProperty(w,"__esModule",{value:!0});var n=void 0;w.Worker=n;const F=require("child_process");n=({command:r,args:e,cwd:o}={command:"npx",args:[]},s=!0)=>new Promise(($,p)=>{const t=F.spawn(r,e,{cwd:o});s&&(t.stderr.pipe(process.stderr),t.stdout.pipe(process.stdout)),t.on("close",r=>0!==r?p(!!r):$(!!r))}),w.Worker=n;var e={},D=e&&e.__awaiter||function($,e,r,a){return new(r||(r=Promise))(function(s,c){function t($){try{i(a.next($))}catch(e){c(e)}}function u($){try{i(a.throw($))}catch(e){c(e)}}function i($){var e;$.done?s($.value):(e=$.value,e instanceof r?e:new r(function($){$(e)})).then(t,u)}i((a=a.apply($,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});var u=void 0;e.buildPackages=u;const J=require("fs"),C=require("path"),P=require("util");function aa(){return D(this,void 0,void 0,function*(){return yield Promise.all((yield P.promisify(J.readdir)(C.join(process.cwd(),f))).map($=>D(this,void 0,void 0,function*(){yield n({command:"npx",args:r(a.BUILD,"tsc").split(" "),cwd:C.join(process.cwd(),f,$)},!1)})))})}u=aa,e.buildPackages=u;var i={},E=i&&i.__awaiter||function(e,$,o,r){return new(o||(o=Promise))(function(a,t){function c(e){try{Q(r.next(e))}catch($){t($)}}function n(e){try{Q(r.throw(e))}catch($){t($)}}function Q(e){var $;e.done?a(e.value):($=e.value,$ instanceof o?$:new o(function(e){e($)})).then(c,n)}Q((r=r.apply(e,$||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});var z=void 0;i.copyPackages=z;function K(e){return E(this,void 0,void 0,function*(){yield Promise.all(e.map(({folder:e})=>E(this,void 0,void 0,function*(){const $=["-r","--exclude","node_modules","--exclude","dist","--exclude",".cache",e,`./${f}`];yield n({command:"rsync",args:$})})))})}z=K,i.copyPackages=z;var A={};Object.defineProperty(A,"__esModule",{value:!0});var g=void 0;A.writeFileJson=g;const R=require("fs"),W=require("path");function Y(e,$){R.writeFileSync(W.join(process.cwd(),e),JSON.stringify($,null,2),{encoding:"utf-8"})}g=Y,A.writeFileJson=g;var l={},ea=l&&l.__awaiter||function(e,n,r,$){return new(r||(r=Promise))(function(a,t){function i(e){try{o($.next(e))}catch(n){t(n)}}function l(e){try{o($.throw(e))}catch(n){t(n)}}function o(e){var n;e.done?a(e.value):(n=e.value,n instanceof r?n:new r(function(e){e(n)})).then(i,l)}o(($=$.apply(e,n||[])).next())})};Object.defineProperty(l,"__esModule",{value:!0});var d=void 0;l.exitHandler=d;const G=require("fs"),H=require("util");function I(e){return ea(this,void 0,void 0,function*(){m(a.LEAVE_CHANGES)?(yield H.promisify(G.exists)(b.PACKAGE_TEMP_JSON))||g(b.PACKAGE_TEMP_JSON,e):g(b.PACKAGE_JSON,e),process.exit()})}d=I,l.exitHandler=d;var o={},B=o&&o.__awaiter||function(e,$,i,n){return new(i||(i=Promise))(function(o,t){function r(e){try{a(n.next(e))}catch($){t($)}}function p(e){try{a(n.throw(e))}catch($){t($)}}function a(e){var $;e.done?o(e.value):($=e.value,$ instanceof i?$:new i(function(e){e($)})).then(r,p)}a((n=n.apply(e,$||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});var y=void 0;o.modifyJson=y;const M=require("fs"),N=require("util");function O(e,$){return B(this,void 0,void 0,function*(){yield Promise.all($.map(({dep:$})=>B(this,void 0,void 0,function*(){e.dependencies[$]=`file:./${f}/${$.includes("/")?$.split("/")[1]:$}`}))),yield N.promisify(M.writeFile)(b.PACKAGE_JSON,JSON.stringify(e,null,2),{encoding:"utf-8"})})}y=O,o.modifyJson=y;var q={},Q=q&&q.__awaiter||function(r,$,e,t){return new(e||(e=Promise))(function(n,o){function a(r){try{J(t.next(r))}catch($){o($)}}function i(r){try{J(t.throw(r))}catch($){o($)}}function J(r){var $;r.done?n(r.value):($=r.value,$ instanceof e?$:new e(function(r){r($)})).then(a,i)}J((t=t.apply(r,$||[])).next())})};Object.defineProperty(q,"__esModule",{value:!0});var s=void 0;q.readJson=s;const S=require("fs"),T=require("path"),U=require("util");function V(r){return Q(this,void 0,void 0,function*(){return JSON.parse((yield U.promisify(S.readFile)(T.join(process.cwd(),r),{encoding:"utf-8"})))})}s=V,q.readJson=s;var p={},X=p&&p.__awaiter||function(r,e,n,$){return new(n||(n=Promise))(function(t,o){function i(r){try{w($.next(r))}catch(e){o(e)}}function a(r){try{w($.throw(r))}catch(e){o(e)}}function w(r){var e;r.done?t(r.value):(e=r.value,e instanceof n?e:new n(function(r){r(e)})).then(i,a)}w(($=$.apply(r,e||[])).next())})};Object.defineProperty(p,"__esModule",{value:!0});var v=void 0;p.revertJson=v;const Z=require("fs"),$=require("util");function _(r,e){return X(this,void 0,void 0,function*(){g(r,(yield s(e))),yield $.promisify(Z.unlink)(e)})}v=_,p.revertJson=v;var h={},ba=h&&h.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(n,i){function t(r){try{s(a.next(r))}catch(e){i(e)}}function o(r){try{s(a.throw(r))}catch(e){i(e)}}function s(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,o)}s((a=a.apply(r,e||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});var x=void 0;h.createVirtualSymlink=x;function da(){return ba(this,void 0,void 0,function*(){const r=yield s(b.PACKAGE_JSON);r.fireConfig=r.fireConfig||{};const e=r.fireConfig.runner||t;if(m(a.REVERT))return yield v(b.PACKAGE_JSON,b.PACKAGE_TEMP_JSON);const $=JSON.parse(JSON.stringify(r));if(r&&r.fireDependencies){const e=r.fireDependencies,n=Object.keys(e).map(r=>({dep:r,folder:e[r]}));if(yield z(n),m(a.BUILD))try{yield u()}catch(a){}process.stdin.resume(),process.on("exit",()=>d($)),process.on("SIGINT",()=>d($)),process.on("SIGUSR1",()=>d($)),process.on("SIGUSR2",()=>d($)),process.on("uncaughtException",()=>d($)),yield y(r,n)}yield n({command:"npx",args:[e,...process.argv.slice(2).filter(r=>r!==a.LEAVE_CHANGES&&r!==a.REVERT&&r!==a.BUILD)]}),d($)})}x=da,h.createVirtualSymlink=x;var j={},L=j&&j.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(c,a){function i(t){try{o(n.next(t))}catch(e){a(e)}}function $(t){try{o(n.throw(t))}catch(e){a(e)}}function o(t){var e;t.done?c(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,$)}o((n=n.apply(t,e||[])).next())})};Object.defineProperty(j,"__esModule",{value:!0});function ca(){return L(this,void 0,void 0,function*(){try{yield x()}catch(t){console.log(t)}})}ca();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=j}else if(typeof define==="function"&&define.amd){define(function(){return j})}})();