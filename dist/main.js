#!/usr/bin/env node
(function () {var b,a,d={};Object.defineProperty(d,"__esModule",{value:!0});var f=".packages";d.linkedPackagesName=f;var fa,ga,t="firebase";d.DEFAULT_RUNNER=t,function(e){e.PACKAGE_JSON="package.json",e.PACKAGE_TEMP_JSON="package.temp.json"}(fa=b||(b={},d.WorkingFiles=b)),function(e){e.REVERT="--revert-changes",e.BUILD="--buildCommand",e.LEAVE_CHANGES="--leave-changes"}(ga=a||(a={},d.Tasks=a));var q={};Object.defineProperty(q,"__esModule",{value:!0});var g=e=>process.argv.toString().includes(e);q.includes=g;var u=(e,r=!0,t=e=>e)=>{if(process.argv.toString().includes(a[e])){const $=process.argv[process.argv.indexOf(e)+1];return $?$.includes("--")?r:t($):r}return r};q.nextOrDefault=u;var r={};Object.defineProperty(r,"__esModule",{value:!0});const F=require("child_process");var h=({command:r,args:e,cwd:s}={command:"npx",args:[]},o=!0)=>new Promise(($,p)=>{const c=F.spawn(r,e,{cwd:s});o&&(c.stderr.pipe(process.stderr),c.stdout.pipe(process.stdout)),c.on("close",r=>0!==r?p(!!r):$(!!r))});r.Worker=h;var i={},v=i&&i.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(s,c){function t(r){try{i(a.next(r))}catch(e){c(e)}}function u(r){try{i(a.throw(r))}catch(e){c(e)}}function i(r){var e;r.done?s(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,u)}i((a=a.apply(r,e||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const G=require("fs"),w=require("path"),H=require("util");function I(){return v(this,void 0,void 0,function*(){return yield Promise.all((yield H.promisify(G.readdir)(w.join(process.cwd(),f))).map(r=>v(this,void 0,void 0,function*(){yield h({command:"npx",args:u(a.BUILD,"tsc").split(" "),cwd:w.join(process.cwd(),f,r)},!1)})))})}var x=I;i.buildPackages=x;var j={},y=j&&j.__awaiter||function(e,r,o,$){return new(o||(o=Promise))(function(a,n){function t(e){try{Q($.next(e))}catch(r){n(r)}}function c(e){try{Q($.throw(e))}catch(r){n(r)}}function Q(e){var r;e.done?a(e.value):(r=e.value,r instanceof o?r:new o(function(e){e(r)})).then(t,c)}Q(($=$.apply(e,r||[])).next())})};Object.defineProperty(j,"__esModule",{value:!0});function J(e){return y(this,void 0,void 0,function*(){yield Promise.all(e.map(({folder:e})=>y(this,void 0,void 0,function*(){const r=["-r","--exclude","node_modules","--exclude","dist","--exclude",".cache",e,`./${f}`];yield h({command:"rsync",args:r})})))})}var z=J;j.copyPackages=z;var A={};Object.defineProperty(A,"__esModule",{value:!0});const K=require("fs"),L=require("path");function M(e,$){K.writeFileSync(L.join(process.cwd(),e),JSON.stringify($,null,2),{encoding:"utf-8"})}var k=M;A.writeFileJson=k;var l={},N=l&&l.__awaiter||function(n,e,r,a){return new(r||(r=Promise))(function($,t){function i(n){try{o(a.next(n))}catch(e){t(e)}}function l(n){try{o(a.throw(n))}catch(e){t(e)}}function o(n){var e;n.done?$(n.value):(e=n.value,e instanceof r?e:new r(function(n){n(e)})).then(i,l)}o((a=a.apply(n,e||[])).next())})};Object.defineProperty(l,"__esModule",{value:!0});const O=require("fs"),P=require("util");function Q(n){return N(this,void 0,void 0,function*(){g(a.LEAVE_CHANGES)?(yield P.promisify(O.exists)(b.PACKAGE_TEMP_JSON))||k(b.PACKAGE_TEMP_JSON,n):k(b.PACKAGE_JSON,n),process.exit()})}var c=Q;l.exitHandler=c;var m={},B=m&&m.__awaiter||function(e,i,$,n){return new($||($=Promise))(function(t,o){function r(e){try{p(n.next(e))}catch(i){o(i)}}function a(e){try{p(n.throw(e))}catch(i){o(i)}}function p(e){var i;e.done?t(e.value):(i=e.value,i instanceof $?i:new $(function(e){e(i)})).then(r,a)}p((n=n.apply(e,i||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});const R=require("fs"),S=require("util");function T(e,i){return B(this,void 0,void 0,function*(){yield Promise.all(i.map(({dep:i})=>B(this,void 0,void 0,function*(){e.dependencies[i]=`file:./${f}/${i.split("/")[1]}`}))),yield S.promisify(R.writeFile)(b.PACKAGE_JSON,JSON.stringify(e,null,2),{encoding:"utf-8"})})}var C=T;m.modifyJson=C;var n={},U=n&&n.__awaiter||function(r,e,$,t){return new($||($=Promise))(function(n,a){function o(r){try{J(t.next(r))}catch(e){a(e)}}function i(r){try{J(t.throw(r))}catch(e){a(e)}}function J(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(o,i)}J((t=t.apply(r,e||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const V=require("fs"),W=require("path"),X=require("util");function Y(r){return U(this,void 0,void 0,function*(){return JSON.parse((yield X.promisify(V.readFile)(W.join(process.cwd(),r),{encoding:"utf-8"})))})}var s=Y;n.readJson=s;var o={},Z=o&&o.__awaiter||function(n,r,e,$){return new(e||(e=Promise))(function(t,o){function i(n){try{w($.next(n))}catch(r){o(r)}}function a(n){try{w($.throw(n))}catch(r){o(r)}}function w(n){var r;n.done?t(n.value):(r=n.value,r instanceof e?r:new e(function(n){n(r)})).then(i,a)}w(($=$.apply(n,r||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const $=require("fs"),_=require("util");function aa(n,r){return Z(this,void 0,void 0,function*(){k(n,(yield s(r))),yield _.promisify($.unlink)(r)})}var D=aa;o.revertJson=D;var p={},ba=p&&p.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(n,i){function t(r){try{s(a.next(r))}catch(e){i(e)}}function o(r){try{s(a.throw(r))}catch(e){i(e)}}function s(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,o)}s((a=a.apply(r,e||[])).next())})};Object.defineProperty(p,"__esModule",{value:!0});function ca(){return ba(this,void 0,void 0,function*(){const r=yield s(b.PACKAGE_JSON);r.fireConfig=r.fireConfig||{};const e=r.fireConfig.runner||t;if(g(a.REVERT))return yield D(b.PACKAGE_JSON,b.PACKAGE_TEMP_JSON);const $=JSON.parse(JSON.stringify(r));if(r&&r.fireDependencies){const e=r.fireDependencies,n=Object.keys(e).map(r=>({dep:r,folder:e[r]}));if(yield z(n),g(a.BUILD))try{yield x()}catch(a){}process.stdin.resume(),process.on("exit",()=>c($)),process.on("SIGINT",()=>c($)),process.on("SIGUSR1",()=>c($)),process.on("SIGUSR2",()=>c($)),process.on("uncaughtException",()=>c($)),yield C(r,n)}yield h({command:"npx",args:[e,...process.argv.slice(2).filter(r=>r!==a.LEAVE_CHANGES&&r!==a.REVERT&&r!==a.BUILD)]}),c($)})}var E=ca;p.createVirtualSymlink=E;var e={},da=e&&e.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(c,a){function i(t){try{o(n.next(t))}catch(e){a(e)}}function $(t){try{o(n.throw(t))}catch(e){a(e)}}function o(t){var e;t.done?c(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,$)}o((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});function ea(){return da(this,void 0,void 0,function*(){try{yield E()}catch(t){console.log(t)}})}ea();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e}else if(typeof define==="function"&&define.amd){define(function(){return e})}})();